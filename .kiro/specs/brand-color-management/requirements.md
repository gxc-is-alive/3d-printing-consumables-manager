# 需求文档

## 简介

品牌颜色管理功能允许用户为每个品牌维护一个颜色列表，在新增耗材时可以从已有颜色中选择，也可以输入新颜色并自动添加到品牌颜色库中。这样可以统一颜色命名，避免手动输入时的误差（如"白色"和"白"被当作不同颜色）。

## 术语表

- **Brand（品牌）**: 耗材的生产商或品牌，如 eSUN、Bambu Lab 等
- **BrandColor（品牌颜色）**: 属于特定品牌的颜色记录，包含颜色名称和颜色代码
- **Color_Name（颜色名称）**: 颜色的文字描述，如"白色"、"哑光黑"
- **Color_Hex（颜色代码）**: 颜色的十六进制表示，如 #FFFFFF
- **Consumable（耗材）**: 3D打印耗材记录
- **Color_Picker（颜色选择器）**: 用于选择已有颜色或输入新颜色的UI组件

## 需求

### 需求 1：品牌颜色数据管理

**用户故事：** 作为用户，我希望能够管理每个品牌下的颜色列表，以便统一颜色命名并方便后续选择。

#### 验收标准

1. THE BrandColor 模型 SHALL 包含 id、brandId、colorName、colorHex、userId、createdAt、updatedAt 字段
2. WHEN 创建品牌颜色时，THE 系统 SHALL 验证 colorName 不为空且 colorHex 为有效的十六进制颜色格式
3. WHEN 同一品牌下已存在相同颜色名称时，THE 系统 SHALL 拒绝创建并返回错误信息
4. WHEN 删除品牌时，THE 系统 SHALL 级联删除该品牌下的所有颜色记录
5. WHEN 查询品牌颜色列表时，THE 系统 SHALL 按颜色名称字母顺序排序返回

### 需求 2：品牌颜色 CRUD API

**用户故事：** 作为开发者，我希望有完整的品牌颜色 API，以便前端能够进行颜色的增删改查操作。

#### 验收标准

1. WHEN 调用 GET /api/brands/:brandId/colors 时，THE 系统 SHALL 返回该品牌下的所有颜色列表
2. WHEN 调用 POST /api/brands/:brandId/colors 时，THE 系统 SHALL 创建新的品牌颜色并返回创建结果
3. WHEN 调用 PUT /api/brands/:brandId/colors/:colorId 时，THE 系统 SHALL 更新指定颜色的信息
4. WHEN 调用 DELETE /api/brands/:brandId/colors/:colorId 时，THE 系统 SHALL 删除指定颜色
5. IF 用户尝试操作不属于自己的品牌颜色，THEN THE 系统 SHALL 返回 403 禁止访问错误

### 需求 3：耗材表单颜色选择

**用户故事：** 作为用户，我希望在新增耗材时能够从品牌已有颜色中选择，以便快速填写并保持颜色命名一致。

#### 验收标准

1. WHEN 用户在耗材表单中选择品牌后，THE 系统 SHALL 加载并显示该品牌的颜色列表供选择
2. WHEN 用户从颜色列表中选择一个颜色时，THE 系统 SHALL 自动填充颜色名称和颜色代码
3. WHEN 用户切换品牌时，THE 系统 SHALL 清空已选颜色并加载新品牌的颜色列表
4. WHEN 品牌没有任何颜色记录时，THE 系统 SHALL 显示空状态提示并允许用户手动输入

### 需求 4：新颜色自动添加

**用户故事：** 作为用户，我希望输入新颜色时能自动添加到品牌颜色库，以便下次可以直接选择。

#### 验收标准

1. WHEN 用户输入的颜色名称不在当前品牌颜色列表中，THE 系统 SHALL 在保存耗材时自动将该颜色添加到品牌颜色库
2. WHEN 自动添加颜色成功后，THE 系统 SHALL 更新本地颜色列表以包含新添加的颜色
3. IF 自动添加颜色失败，THEN THE 系统 SHALL 仍然保存耗材但显示颜色添加失败的提示
4. WHEN 用户输入的颜色名称已存在于品牌颜色列表中，THE 系统 SHALL 不重复添加

### 需求 5：品牌颜色管理界面

**用户故事：** 作为用户，我希望有专门的界面来管理品牌颜色，以便进行批量管理和维护。

#### 验收标准

1. WHEN 用户进入品牌详情页时，THE 系统 SHALL 显示该品牌的颜色列表
2. WHEN 用户点击添加颜色按钮时，THE 系统 SHALL 显示颜色添加表单
3. WHEN 用户左滑颜色项时，THE 系统 SHALL 显示编辑和删除操作按钮
4. WHEN 用户确认删除颜色时，THE 系统 SHALL 删除该颜色并更新列表
5. WHEN 编辑颜色时，THE 系统 SHALL 允许修改颜色名称和颜色代码

### 需求 6：现有数据颜色迁移

**用户故事：** 作为用户，我希望系统能自动从现有耗材数据中提取颜色并添加到品牌颜色库，以便无需手动重新录入。

#### 验收标准

1. WHEN 系统首次部署或执行迁移脚本时，THE 系统 SHALL 扫描所有现有耗材记录
2. WHEN 发现耗材的颜色名称在对应品牌颜色库中不存在时，THE 系统 SHALL 自动创建该颜色记录
3. WHEN 多个耗材使用相同品牌和颜色名称时，THE 系统 SHALL 只创建一条颜色记录
4. WHEN 耗材有 colorHex 值时，THE 系统 SHALL 使用该值作为颜色代码；否则使用默认值 #CCCCCC
5. WHEN 迁移完成后，THE 系统 SHALL 记录迁移结果日志，包括成功和失败的数量
