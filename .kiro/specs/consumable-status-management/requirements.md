# 需求文档

## 简介

本功能旨在改进3D打印耗材管理系统的耗材状态管理机制。当前系统中，用完的耗材会被直接删除，导致历史数据丢失，无法进行统计分析。本功能将引入"已用完"状态，使耗材数据得以保留，同时提供新的筛选视图以便用户快速查看已开封的耗材。

## 术语表

- **Consumable（耗材）**: 3D打印使用的材料，如PLA、ABS等
- **Status（状态）**: 耗材的当前使用状态，包括未开封、已开封、已用完
- **Opened（已开封）**: 耗材包装已打开，正在使用中
- **Depleted（已用完）**: 耗材已完全消耗，剩余重量为0或接近0
- **Filter（筛选）**: 根据条件过滤显示耗材列表的功能
- **Statistics（统计）**: 基于历史数据的使用分析和报表

## 需求

### 需求 1：耗材状态扩展

**用户故事：** 作为用户，我希望耗材有"已用完"状态，这样我可以保留历史数据用于统计分析，而不是直接删除。

#### 验收标准

1. THE Consumable_Model SHALL 支持三种状态：未开封（unopened）、已开封（opened）、已用完（depleted）
2. WHEN 耗材的剩余重量为0或低于阈值时，THE System SHALL 允许用户将其标记为"已用完"
3. WHEN 耗材被标记为"已用完"时，THE System SHALL 记录用完时间（depletedAt）
4. THE System SHALL 保留已用完耗材的所有历史数据，包括使用记录
5. WHEN 用户查看耗材详情时，THE System SHALL 显示耗材的完整状态信息

### 需求 2：标记耗材为已用完

**用户故事：** 作为用户，我希望能够手动将耗材标记为"已用完"，这样我可以准确记录耗材的生命周期。

#### 验收标准

1. WHEN 用户在耗材列表中滑动操作时，THE System SHALL 显示"用完"操作按钮
2. WHEN 用户点击"用完"按钮时，THE System SHALL 显示确认对话框
3. WHEN 用户确认标记为已用完时，THE System SHALL 更新耗材状态为"depleted"并记录时间
4. WHEN 耗材被标记为已用完时，THE System SHALL 将剩余重量设置为0
5. IF 用户误操作标记了耗材为已用完，THEN THE System SHALL 允许用户撤销此操作（恢复为已开封状态）

### 需求 3：已用完耗材的显示处理

**用户故事：** 作为用户，我希望已用完的耗材在默认列表中有特殊显示，这样我可以区分正在使用和已用完的耗材。

#### 验收标准

1. WHEN 显示耗材列表时，THE System SHALL 默认隐藏已用完的耗材
2. THE System SHALL 提供筛选选项，允许用户选择显示已用完的耗材
3. WHEN 已用完的耗材被显示时，THE System SHALL 使用灰色样式或特殊标记区分
4. WHEN 显示已用完耗材时，THE System SHALL 显示"已用完"标签和用完日期
5. THE System SHALL 在筛选面板中提供"显示已用完"的开关选项

### 需求 4：已开封耗材快速筛选

**用户故事：** 作为用户，我希望能够快速查看所有已开封的耗材，这样我可以优先使用已开封的材料避免浪费。

#### 验收标准

1. THE System SHALL 在耗材列表页面提供"已开封"快捷筛选入口
2. WHEN 用户点击"已开封"筛选时，THE System SHALL 只显示状态为已开封的耗材
3. WHEN 显示已开封耗材列表时，THE System SHALL 按开封时间排序（最早开封的在前）
4. THE System SHALL 显示每个已开封耗材的开封天数
5. WHEN 已开封耗材超过一定天数（如30天）时，THE System SHALL 显示提醒标记

### 需求 5：耗材状态筛选增强

**用户故事：** 作为用户，我希望能够按照耗材状态进行筛选，这样我可以更灵活地管理我的耗材库存。

#### 验收标准

1. THE Filter_Panel SHALL 提供状态筛选选项：全部、未开封、已开封、已用完
2. WHEN 用户选择状态筛选时，THE System SHALL 立即更新列表显示
3. THE System SHALL 支持状态筛选与其他筛选条件（品牌、类型）的组合使用
4. WHEN 筛选条件激活时，THE System SHALL 在界面上显示当前筛选状态
5. THE System SHALL 提供清除所有筛选条件的快捷操作

### 需求 6：数据统计支持

**用户故事：** 作为用户，我希望已用完的耗材数据能够用于统计分析，这样我可以了解我的耗材使用情况。

#### 验收标准

1. THE System SHALL 在统计功能中包含已用完耗材的数据
2. WHEN 计算耗材使用统计时，THE System SHALL 包括已用完耗材的使用记录
3. THE System SHALL 能够统计每种品牌/类型耗材的平均使用周期
4. THE System SHALL 能够统计耗材的总消耗量和消耗金额
5. WHEN 生成统计报表时，THE System SHALL 区分在用耗材和已用完耗材的数据
