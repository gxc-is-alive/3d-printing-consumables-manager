# 实现计划：Electron 桌面应用

## 概述

将 3D 打印耗材管理系统打包成 Electron 桌面应用，保留现有 Web 架构的同时提供 exe 可执行文件。

## 任务

- [x] 1. 初始化 Electron 项目结构

  - [x] 1.1 创建 `electron/` 目录和 package.json
    - 配置 Electron、electron-builder 依赖
    - 配置 TypeScript 和构建脚本
    - _需求: 1.1, 1.2, 1.4_
  - [x] 1.2 创建 tsconfig.json 配置
    - 配置 TypeScript 编译选项
    - _需求: 1.4_
  - [x] 1.3 创建 electron-builder.yml 打包配置
    - 配置应用名称、图标、输出目录
    - 配置 Windows exe 打包选项
    - _需求: 5.1, 5.4_

- [x] 2. 实现后端进程管理器

  - [x] 2.1 创建 `src/backend-manager.ts`
    - 实现 start() 方法启动后端子进程
    - 实现 stop() 方法优雅关闭后端
    - 实现 waitForReady() 方法轮询健康检查
    - 实现 isRunning() 方法检查运行状态
    - _需求: 2.1, 2.2, 2.3_
  - [x] 2.2 实现数据库路径解析逻辑
    - 开发模式使用项目目录
    - 生产模式使用用户数据目录
    - _需求: 4.2_
  - [x] 2.3 编写数据库路径解析的属性测试
    - **Property 2: 数据库路径解析**
    - **验证: 需求 4.2**

- [x] 3. 实现 Electron 主进程

  - [x] 3.1 创建 `src/main.ts` 主进程入口
    - 实现 app ready 事件处理
    - 创建 BrowserWindow 主窗口
    - 集成后端进程管理器
    - _需求: 3.1, 3.4_
  - [x] 3.2 实现启动加载界面
    - 显示启动画面等待后端就绪
    - 后端就绪后加载前端
    - _需求: 3.2, 3.3_
  - [x] 3.3 实现错误处理和重试逻辑
    - 后端启动失败时显示错误对话框
    - 提供重试和退出选项
    - _需求: 2.4_
  - [x] 3.4 创建 `src/preload.ts` 预加载脚本
    - 暴露必要的 API 给渲染进程
    - _需求: 3.1_

- [x] 4. 配置开发模式

  - [x] 4.1 添加开发模式脚本
    - 配置 npm run dev 启动开发模式
    - 开发模式连接到 Vite 开发服务器
    - _需求: 6.1, 6.4_
  - [x] 4.2 配置开发者工具快捷键
    - F12 或 Ctrl+Shift+I 打开开发者工具
    - _需求: 6.3_

- [x] 5. 配置生产构建和打包

  - [x] 5.1 创建构建脚本
    - 构建前端到 dist 目录
    - 构建后端到 dist 目录
    - 复制必要文件到 Electron 目录
    - _需求: 5.3_
  - [x] 5.2 配置 Prisma 打包
    - 确保 Prisma client 和 query engine 被正确打包
    - 配置数据库迁移脚本
    - _需求: 4.3, 4.4_
  - [x] 5.3 添加打包脚本
    - 配置 npm run build:exe 生成 exe
    - _需求: 5.1, 5.2_

- [x] 6. 检查点 - 验证打包结果
  - 确保所有测试通过
  - 手动测试 exe 文件运行
  - 如有问题请询问用户

## 备注

- 每个任务都引用了具体的需求以便追溯
- 检查点用于确保增量验证
- 属性测试验证通用正确性属性
- 单元测试验证具体示例和边界情况
